<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>JSON2Video (Replit) - Demo</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;padding:20px;background:#111;color:#eee}
    textarea{width:100%;height:320px;background:#222;color:#fff;padding:10px;border-radius:6px;border:1px solid #333}
    button{padding:10px 16px;border-radius:6px;border:0;background:#0b74de;color:white;cursor:pointer}
    .small{font-size:14px;color:#bbb}
    .log{background:#0b0b0b;padding:10px;border-radius:6px;margin-top:10px;white-space:pre-wrap;color:#9f9}
  </style>
</head>
<body>
  <h1>JSON2Video â€” Replit Demo</h1>
  <p class="small">Paste JSON (scenes + elements). Example JSON is pre-filled.</p>
  <textarea id="jsonInput"></textarea>
  <div style="margin-top:8px">
    <button id="send">Create Video</button>
    <span id="status" style="margin-left:12px;color:#ddd"></span>
  </div>
  <div id="log" class="log"></div>

<script>
const example = {
  "resolution":"1080x1920",
  "scenes":[
    {"duration":5,"elements":[{"type":"image","src":"https://images.pexels.com/photos/19783674/pexels-photo-19783674.jpeg"}]},
    {"duration":5,"elements":[{"type":"image","src":"https://images.pexels.com/photos/19437845/pexels-photo-19437845.jpeg"}]}
  ],
  "elements":[
    {"type":"audio","src":"https://files.catbox.moe/vzbloq.mp3"},
    {"type":"caption","text":"This is a demo caption"}
  ]
};
document.getElementById('jsonInput').value = JSON.stringify(example, null, 2);

document.getElementById('send').onclick = async () => {
  const body = document.getElementById('jsonInput').value;
  document.getElementById('status').textContent = "Sending...";
  document.getElementById('log').textContent = "";
  try {
    const res = await fetch('/render', {method:'POST', headers:{'Content-Type':'application/json'}, body});
    const data = await res.json();
    document.getElementById('status').textContent = "Job created: " + data.job_id;
    pollStatus(data.job_id);
  } catch (err) {
    document.getElementById('status').textContent = "Error: " + err.message;
  }
};

async function pollStatus(job_id){
  const log = document.getElementById('log');
  log.textContent += "Polling status for " + job_id + "\n";
  let done=false;
  while(!done){
    await new Promise(r=>setTimeout(r,5000));
    try{
      const res = await fetch('/status/' + job_id);
      if(res.status===404){ log.textContent += "Not found (404)\n"; continue; }
      const j = await res.json();
      log.textContent += JSON.stringify(j) + "\n";
      if(j.status === 'done'){ done=true; const url = j.video_url; log.textContent += "Video ready: " + url + "\n"; const a = document.createElement('a'); a.href = url; a.textContent = 'Download video'; a.target='_blank'; document.body.appendChild(a); break;}
      if(j.status === 'failed'){ log.textContent += "Job failed\n"; break;}
    }catch(e){
      log.textContent += "Poll error: " + e.message + "\n";
    }
  }
}
</script>
</body>
</html>
